# Gold Token Monitor

Gold Token Monitor is a **read-only, production-grade market intelligence dashboard** for the **Top 10 Tokenized Gold tokens**, built for **Katusa Research**. The application delivers **real CoinGecko FREE market data**, **deterministic financial analytics**, and **server-side AI Market Intelligence** generated by **Gemini 2.5 Flash**, with an automatic **OpenRouter FREE-model fallback**. All data is delivered through a **global server-side snapshot model**, ensuring that **every viewer sees the exact same data** during each refresh window.

AUTHORITATIVE DOCUMENTATION  
This repository is governed by two documents, both stored in the `blueprint/` folder. **KR Gold Token Blueprint.md** is the single authoritative source of truth for architecture, data flow, logic, formulas, refresh cadence, caching rules, and file structure. **README.md** (this file) explains how to run, build, and deploy the application. If any conflict exists between these documents, **KR Gold Token Blueprint.md always takes precedence**.

CORE PRINCIPLES  
Real data only. No mock data, fake values, placeholder numbers, simulated prices, or invented fallbacks. CoinGecko **FREE API only**, using unauthenticated `/api/v3` endpoints. Primary AI is **Gemini 2.5 Flash** (server-side only). AI fallback is **OpenRouter using FREE models only**, automatically triggered if Gemini fails. Read-only UI with no user-triggered refresh. Single global snapshot shared by all viewers per refresh window. Strict TypeScript, deterministic logic, stable layout, no `NaN` or `undefined` values.

REFRESH AND CACHING MODEL  
Weekdays (Monday-Friday, UTC): automatic snapshot refresh every **5 minutes**. Weekends (Saturday-Sunday, UTC): automatic snapshot refresh every **15 minutes**. All viewers receive the **same cached snapshot** within each refresh window. The browser never calls CoinGecko, Gemini, or OpenRouter directly. The browser only requests `GET /api/snapshot`.

EXTERNAL DATA AND AI INTELLIGENCE  
CoinGecko is used to fetch the **Top 10 Tokenized Gold tokens** and their **7-day price charts** using FREE public `/api/v3` endpoints only. No API keys, Pro endpoints, or Demo endpoints are used. Gemini AI uses **Gemini 2.5 Flash**, server-side only, executing **one batched request per snapshot**. Every snapshot uses **Google Search Grounding** to retrieve the **current live Spot Gold Price (USD per troy ounce)**. The Gemini-retrieved spot gold price is the **authoritative reference** for all gold-pegged calculations. **Approved exception:** if Gemini returns a null/invalid spot price, the server may fallback to `https://data-asg.goldprice.org/dbXRates/USD`. OpenRouter is used **only if Gemini fails**, restricted strictly to **FREE models**. If both Gemini and OpenRouter fail, AI output resolves to **N/A / UNKNOWN**.

DERIVED METRICS AND SAFETY RULES  
All derived metrics are computed **deterministically** in `lib/compute.ts`. Peg deviation and peg stability calculations always reference the Gemini-retrieved spot gold price when available. **Critical safety rule:** if the spot gold price is missing, null, or invalid, **all peg-derived status fields MUST resolve to `UNKNOWN`** and must never default to `NORMAL`. Prompt-only non-peg metrics may be computed before spot price resolution to enrich the Gemini request.

UI BEHAVIOR  
The layout shell renders immediately. Data populates when the snapshot is available. If data is unavailable, the UI displays **N/A** or **UNKNOWN**. **Layout-only skeleton placeholders** may appear briefly on the **initial load only** to preserve layout stability. Skeletons contain **no numbers**, **no text**, and **no implied progress or certainty**, and disappear as soon as real data is injected. **Spinners, progress bars, countdowns, and "loading..." text are never used.** The **Spot Gold Price** is displayed in the header, right-aligned opposite the logo/app name.

DIAGNOSTICS  
If spot price resolution fails, the server may append a diagnostic line to `spot-price-debug.log` at the repo root (local/dev visibility only). This log is best-effort and must not block the response.

TECH STACK  
Framework: **Next.js (App Router)**. Language: **TypeScript (strict)**. Styling: **Tailwind CSS**. Charts: **Recharts**. Runtime: **Node.js 20 LTS**. Hosting: **Vercel**.

FILE STRUCTURE  
All files and folders must follow the structure defined in **KR Gold Token Blueprint.md**. Key enforced rules: `/app/api/snapshot/route.ts` is the **single and only server API endpoint**. `/lib` contains all CoinGecko access, Gemini logic, OpenRouter fallback logic, metric computation, normalization, retry logic, and scheduling. `/components` contains **UI-only components** and never performs data fetching. `/styles/globals.css` contains global styling rules. `/public/logo.svg` contains branding assets. `.env.local` is used for **local secrets only** and is never committed. No additional API routes, background workers, or hidden logic are permitted.

LOCAL DEVELOPMENT  
Requirements: Node.js **20.x** and npm. Create a `.env.local` file in the project root with `GEMINI_API_KEY=your_gemini_api_key_here`. Optionally, for fallback testing only, add `OPENROUTER_API_KEY=your_openrouter_api_key_here`. Do not add CoinGecko API keys. Run locally with `npm install` followed by `npm run dev`. The app will be available at `http://localhost:3000`. Local behavior is identical to production, including real CoinGecko data, real Gemini AI calls, OpenRouter fallback behavior, snapshot caching, and refresh cadence.

BUILD AND PRODUCTION RUN  
Run `npm run build` and `npm run start`. A build is considered valid only if exactly **10 real tokens** load successfully, sidebar token selection works, 7-day charts render correctly, all metric cards render for the selected token, Market Intelligence content is visible or clearly marked **N/A**, no `NaN` or `undefined` values appear in the UI, and the browser only makes requests to `/api/snapshot`.

DEPLOYMENT (VERCEL)  
Set Node.js to **20.x** in Vercel project settings. Add environment variables `GEMINI_API_KEY` (required) and `OPENROUTER_API_KEY` (optional fallback). Deploy via Vercel Git integration or Vercel CLI. Optional Vercel Cron may warm `/api/snapshot` on the same weekday/weekend cadence; no persistent state or storage is allowed.

WHAT THIS APP DOES NOT DO  
No mock or placeholder data. No CoinGecko Pro or Demo usage. No paid OpenRouter models. No user accounts or authentication. No client-side API calls to CoinGecko, Gemini, or OpenRouter. No multiple API routes or background services. No deviation from **BLUEPRINT.md**.

FINAL NOTE  
This repository must always remain aligned with **KR Gold Token Blueprint.md**. Any implementation, refactor, or extension that violates the blueprint is a defect and must be corrected.

