{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Chris%20Saulon/Downloads/APPS%20-%20PROTOTYPING/Gold%20Token%20Monitor%20-%20Lovable/src/app/api/ai/sentinel/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\n\ninterface TokenData {\n  volume24hUsd: number | null;\n  change24hPct: number | null;\n  marketCapUsd: number | null;\n  priceUsd: number;\n  high24h: number | null;\n  low24h: number | null;\n}\n\ninterface RequestBody {\n  tokenData: TokenData;\n  tokenName: string;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { tokenData, tokenName }: RequestBody = await request.json();\n\n    // Validate required data\n    if (!tokenData || !tokenName) {\n      return Response.json({ error: 'Missing tokenData or tokenName' }, { status: 400 });\n    }\n\n    // Prepare the prompt for Gemini\n    const prompt = `Analyze the market conditions for ${tokenName} token based on the following data:\n    - Current price: $${tokenData.priceUsd}\n    - 24h change: ${tokenData.change24hPct !== null ? tokenData.change24hPct.toFixed(2) + '%' : 'N/A'}\n    - 24h volume: $${tokenData.volume24hUsd !== null ? tokenData.volume24hUsd.toLocaleString() : 'N/A'}\n    - Market cap: $${tokenData.marketCapUsd !== null ? tokenData.marketCapUsd.toLocaleString() : 'N/A'}\n    - 24h high: $${tokenData.high24h !== null ? tokenData.high24h.toFixed(2) : 'N/A'}\n    - 24h low: $${tokenData.low24h !== null ? tokenData.low24h.toFixed(2) : 'N/A'}\n\n    Provide a concise market analysis with:\n    1. A sentiment label (e.g., Bullish Accumulation, Bearish Divergence, Sideways Action, etc.)\n    2. A short narrative explanation (2-3 sentences max) explaining why the market is moving this way based on volume, volatility, trend, and peg behavior.\n\n    Format your response as:\n    SENTIMENT: [sentiment label]\n    EXPLANATION: [short explanation]`;\n\n    // Call the Gemini API\n    const geminiApiKey = process.env.GEMINI_API_KEY;\n    if (!geminiApiKey) {\n      return Response.json({ error: 'GEMINI_API_KEY is not configured' }, { status: 500 });\n    }\n\n    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${geminiApiKey}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        contents: [{\n          parts: [{\n            text: prompt\n          }]\n        }]\n      })\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      console.error('Gemini API error:', errorData);\n      return Response.json({ error: 'Failed to get AI analysis from Gemini', details: errorData }, { status: response.status });\n    }\n\n    const data = await response.json();\n    \n    // Extract the AI response\n    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No analysis available';\n    \n    // Parse the response to extract sentiment and explanation\n    const sentimentMatch = aiText.match(/SENTIMENT:\\s*([^\\n]+)/i);\n    const explanationMatch = aiText.match(/EXPLANATION:\\s*([\\s\\S]*)/i);\n    \n    const sentiment = sentimentMatch ? sentimentMatch[1].trim() : 'ANALYZING';\n    const explanation = explanationMatch ? explanationMatch[1].trim() : aiText.substring(0, 200) + '...';\n\n    return Response.json({\n      sentiment: sentiment,\n      explanation: explanation,\n      generatedAt: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('Error in AI Market Sentinel:', error);\n    return Response.json({ error: 'Internal server error in AI analysis' }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAgBO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,GAAgB,MAAM,QAAQ,IAAI;QAEhE,yBAAyB;QACzB,IAAI,CAAC,aAAa,CAAC,WAAW;YAC5B,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO;YAAiC,GAAG;gBAAE,QAAQ;YAAI;QAClF;QAEA,gCAAgC;QAChC,MAAM,SAAS,CAAC,kCAAkC,EAAE,UAAU;sBAC5C,EAAE,UAAU,QAAQ,CAAC;kBACzB,EAAE,UAAU,YAAY,KAAK,OAAO,UAAU,YAAY,CAAC,OAAO,CAAC,KAAK,MAAM,MAAM;mBACnF,EAAE,UAAU,YAAY,KAAK,OAAO,UAAU,YAAY,CAAC,cAAc,KAAK,MAAM;mBACpF,EAAE,UAAU,YAAY,KAAK,OAAO,UAAU,YAAY,CAAC,cAAc,KAAK,MAAM;iBACtF,EAAE,UAAU,OAAO,KAAK,OAAO,UAAU,OAAO,CAAC,OAAO,CAAC,KAAK,MAAM;gBACrE,EAAE,UAAU,MAAM,KAAK,OAAO,UAAU,MAAM,CAAC,OAAO,CAAC,KAAK,MAAM;;;;;;;;oCAQ9C,CAAC;QAEjC,sBAAsB;QACtB,MAAM,eAAe,QAAQ,GAAG,CAAC,cAAc;QAC/C,IAAI,CAAC,cAAc;YACjB,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO;YAAmC,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,WAAW,MAAM,MAAM,CAAC,uFAAuF,EAAE,cAAc,EAAE;YACrI,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,UAAU;oBAAC;wBACT,OAAO;4BAAC;gCACN,MAAM;4BACR;yBAAE;oBACJ;iBAAE;YACJ;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YACvD,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO;gBAAyC,SAAS;YAAU,GAAG;gBAAE,QAAQ,SAAS,MAAM;YAAC;QACzH;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,0BAA0B;QAC1B,MAAM,SAAS,KAAK,UAAU,EAAE,CAAC,EAAE,EAAE,SAAS,OAAO,CAAC,EAAE,EAAE,QAAQ;QAElE,0DAA0D;QAC1D,MAAM,iBAAiB,OAAO,KAAK,CAAC;QACpC,MAAM,mBAAmB,OAAO,KAAK,CAAC;QAEtC,MAAM,YAAY,iBAAiB,cAAc,CAAC,EAAE,CAAC,IAAI,KAAK;QAC9D,MAAM,cAAc,mBAAmB,gBAAgB,CAAC,EAAE,CAAC,IAAI,KAAK,OAAO,SAAS,CAAC,GAAG,OAAO;QAE/F,OAAO,SAAS,IAAI,CAAC;YACnB,WAAW;YACX,aAAa;YACb,aAAa,IAAI,OAAO,WAAW;QACrC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAAuC,GAAG;YAAE,QAAQ;QAAI;IACxF;AACF"}}]
}